<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
          crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/main.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/white.css'%}" type="text/css" id="theme">

    <style>
.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}

/* Style the buttons that are used to open the tab content */
.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
}

/* Change background color of buttons on hover */
.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
    background-color: #ccc;
}

/* Style the tab content */
.tab-content {
    display: none;
    border: 1px solid #ccc;
    border-top: none;
    padding-top:40px;
    justify-content: space-around;
}

.myMark {
    float: left;
    height: 46px;
    padding: 0 10px;
}
.myMark:not(:checked) > input {
    position:absolute;
    top:-9999px;
}
.myMark:not(:checked) > label {
    float:right;
    width:1em;
    overflow:hidden;
    white-space:nowrap;
    cursor:pointer;
    font-size:30px;
    color:#ccc;
}
.myMark:not(:checked) > label:before {
    content: '★ ';
}
.myMark > input:checked ~ label {
    color: #ffc700;
}
.myMark:not(:checked) > label:hover,
.myMark:not(:checked) > label:hover ~ label {
    color: #deb217;
}
.myMark > input:checked + label:hover,
.myMark > input:checked + label:hover ~ label,
.myMark > input:checked ~ label:hover,
.myMark > input:checked ~ label:hover ~ label,
.myMark > label:hover ~ input:checked ~ label {
    color: #c59b08;
}


    </style>
</head>
<body>
<div style="min-height: 100%;">
<div id="header">
        <p id="logo" style="margin-left: 5%"><a href="/library/">NationalLib</a></p>
    <ul style="font-size: 22px">
        <li style="margin-left: 10%;">
            <a href="/library/catalog">
              Каталог
            </a>
        </li>
        {% if user.is_authenticated%}
            <li style="margin-left: 60%;"><a href="{% url 'profile' %}">Мои закладки</a></li> | <a href="{% url 'logout' %}"> Выход</a>
        {%else%}
            <li style="margin-left: 60%;"></li><a href="{% url 'login' %}">Вход</a></li> | <a href="{% url 'registration' %}"> Регистрация</a></li>
        {% endif %}
    </ul>
<form class="" action="{%url 'search' %}" method="post" >
            <div class="wrap">
                <input type="text" class="input" name="search_field" value="" method='POST'
                       placeholder="Search course" required>
                <i style="display:inline;" class="fas fa-search" aria-hidden="true"></i>
                <div>
                    <div class="searchCriteries">
                        <p style="display: inline;">
                            <input name="type" type="radio" value="by_name" id="contactChoice1">Книга</p>
                    </div>
                    <div class="searchCriteries">
                        <p style="display: inline;">
                            <input name="type" type="radio" value="by_author" id="contactChoice2">Автор</p>
                    </div>
                    <div class="searchCriteries">
                        <p style="display: inline;">
                            <input name="type" type="radio" value="by_country" id="contactChoice3" checked>Страна</p>
                    </div>
                    <div class="searchCriteries">
                        <p style="display: inline;">
                            <input name="type" type="radio" value="by_publisher" id="contactChoice4" checked>Издатель</p>
                    </div>
                    <div class="searchCriteries">
                        <p style="display: inline;">
                            <input name="type" type="radio" value="by_fulltext" checked>Текст</p>
                    </div>
            </div>

        </div>
            {% csrf_token %}
    </form>

</div>

<div class="tab">
    <button class="tablinks" onclick="openCity(event, 'bookView')" id="defaultOpen">Book</button>
    {%if user.is_staff %}
    <button class="tablinks" onclick="openCity(event, 'bookChange')">Change</button>
    {% endif %}
    <button class="tablinks" onclick="openCity(event, 'bookComments')">Comments</button>
</div>

                    <form action="{%url 'delete_book' %}"  method="post">
                        {% csrf_token %}
                            <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                            <button type="submit" >Удалить</button>
                    </form>
<div id="bookView" class="tab-content">
    <div class="firstPart" style="width: 400px;">
        <div class="bookPicture" style="background-image: url('{{media_url}}{{book.book_img}}'); background-size: cover;
                            background-position: center center; width: 400px; height: 480px; border-radius: 20px 20px 0px 0px "></div>
    <div class="Test1" style="background-color: #F4F0F0; border-radius: 0px 0px 20px 20px;">
        {%if user.is_authenticated %}

                <div style="display: flex; justify-content: space-between">

                <div style="margin-bottom: 20px; padding-top: 10px; width: 100%;">
                    {% if usr_mark%}
                            <form style="margin: auto" action="{%url 'mark_book' %}"  method="post">
                                {% csrf_token %}
                                <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                                <input type="text" name="mark" value="delete" method='POST' style="display: none">
                                <div style="margin-left: 25%;">
                                <button type="submit"  style="font-size:20px; padding: 20px;">Delete my mark</button>
                                    </div>
                            </form>
                {% else %}
                        <form action="{%url 'mark_book' %}"  method="post">
                {% csrf_token %}
                <div class="myMark">
                <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                    <input name="mark" type="radio" value="5" id="star5">
                <label for="star5" title="text">5 stars</label>
                    <input name="mark" type="radio" value="4" id="star4">
                <label for="star4" title="text">4 stars</label>
                    <input name="mark" type="radio" value="3" id="star3">
                <label for="star3" title="text">3 stars</label>
                    <input name="mark" type="radio" value="2" id="star2">
                <label for="star2" title="text">2 stars</label>
                    <input name="mark" type="radio" value="1" id="star1">
                <label for="star1" title="text">1 stars</label>
                    </div>
                        <button type="submit" style="border-radius: 5px; font-size: 20px;">Оценить</button>

            </form>
        {% endif %}

                </div>
                </div>
        {% endif %}


    </div>
        <div class="read" style="text-align: center; font-size: 32px;">
        {%if last_read %}
        {% for page in last_read %}
            {% if forloop.counter == 1 %}
                <a href="/library/paper_page/{{page.paper_id.id}}">Продолжить</a>
            {% endif %}
        {% endfor %}
{%else%}
        {% for page in pages %}
            {% if forloop.counter == 1 %}
                <a href="/library/paper_page/{{page.pk}}">Начать читать</a>
            {% endif %}
        {% endfor %}
{% endif %}
    </div>
    <hr>
        <div style="text-align: center; font-size: 32px;" class="bookMark">
            <label>{% for mar in mark %}
    {% if forloop.counter == 2 %}
        Средняя оценка книги - {{mar}}
    {% endif %}
{% endfor %}</label>
        </div>
    <div style="text-align: center">
        Людей проголосовало -
{% for mar in mark %}
    {% if forloop.counter == 1 %}
        {{mar}}
    {% endif %}
{% endfor %}
    </div>
    <hr>
        <div class="type" style="display: flex; justify-content: space-between;">
            {%if user.is_authenticated %}
    {%if book_mark %}
        {% for mark in book_mark %}
            {% if forloop.counter == 1 %}
                <div style="text-align: center; padding: 10px; font-size: 20px;"><label style="background-color: #67ACED; border-radius: 10px; padding: 10px;">{{mark.type}}</label></div>
            {% endif %}
        {% endfor %}
    {%else%}
        <h2>Добавить в список</h2>
    {% endif %}
        <form action="{%url 'change_book_mark' %}" method="post" >
        <select style="text-align: center; border-radius: 5px 5px 0px 0px;" name="type">
            <option style="padding: 10px;" value="Читаю" id="contactChoice4">Читаю</option>
            <option style="padding: 10px;" value="В планах" id="contactChoice4">В планах</option>
            <option style="padding: 10px;" value="Прочитано" id="contactChoice4">Прочитано</option>
            <option style="padding: 10px;" value="Любимое" id="contactChoice4">Любимое</option>
            {%if book_mark %}
                <option name="type" type="radio" value="delete" id="contactChoice4">Удалить</option>
            {% endif %}
        </select>
        <div>
            {% csrf_token %}
            <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
            <button type="submit" style="width: 90px;">Change</button>
        </div>
    </form>
{% endif %}
        </div>
    </div>

    <div class="secondPart" style="width: 600px;">
        <div class="bookFullName" style="font-size: 32px; margin-bottom: 20px;">
{{book.name}}
            <hr>
        </div>
        <div class="bookFullInfo" style=" border-radius:10px;padding: 20px; background-color: #F4F0F0; width: 100%; display: flex; justify-content: space-between;">
            <div>
            <div>
            <label>Book Country - {{book.book_country}}</label>
            <p>Publishing House - {{book.publishing_house}}</p>
            <p>Author - {{book.author_name}}</p>
            <p>Year - {{book.year}}</p>
            </div>
            </div>
            <div>
                <div>
                    <a style="padding: 10px; border-radius:10px;background-color: #C4C4C4;" href="{{media_url}}{{ pdf.book_pdf }}">PDF format</a>
                </div>
            </div>
        </div>
    <hr>
        <div class="rasstyazhka" style="display: flex; flex-wrap: wrap; justify-content: flex-start">
        <label style="font-size: 24px;">Жанры</label>
                    <div style="display: flex; flex-wrap: wrap; justify-content: flex-start; margin-left: 10px;">
                    {% for genre in genres %}
                        <div class="genre__template">
                        <label class="genre__name"><a href="#">{{genre.genre_id.name}}</a></label>
                    </div>


{%if user.is_staff %}

                    <form action="{%url 'delete_genre_from_book' %}"  method="post">
                        {% csrf_token %}
                            <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                            <input type="text" name="genre" value="{{genre.pk}}" method='POST' style="display: none">
                            <button style="border-radius: 50px" type="submit" >X</button>
                    </form>
{% endif %}
                {% endfor %}
                    <div>
                        <div style="padding: 5px;">
                        {%if user.is_staff %}
                                    <form action="{%url 'genre_to_book' %}" method="post">
                                {% csrf_token %}
                                <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                                <select name="genre">
                                    {% for genre in all_genres %}
                                        <option value="{{genre.pk}}">{{genre.name}}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" >add</button>
                            </form>
                        {% endif %}
                         </div>
                    </div>
                    </div>
    </div>
    <div style="font-size: 32px;" class="bookDescription">
            <hr>
{{book.book_description}}
        </div>
            </div>
    <div class="thirdPart">
    <label style="font-size: 32px;">Страницы</label>
    <div class="pages" style=" width:300px; height:400px; margin-top: 40px;background-color: #F4F0F0; overflow: scroll; ">
        {% for page in pages %}
        <div style="padding: 10px;">
            <label><a href="/library/paper_page/{{page.pk}}">Страница {{page.paper_count}}</a></label>
            <hr>
        </div>
        {% endfor %}
    </div>
    <div style="padding: 20px; width: 260px; ">
        <div>
            </div>
    </div>
    </div>
</div>

<div id="bookChange" class="tab-content">
{%if user.is_staff %}
    <form style="display: flex;
    justify-content: space-between;" action="{%url 'update_book' %}"  method="post" enctype="multipart/form-data">
        {% csrf_token %}
    <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
    <div class="firstPart" style="width: 400px;">
        <div class="bookPicture" style="width: 400px; height: 480px; border-radius: 20px;">
        <input type="file" name="book_img" accept="image/*" value="" method='POST' required> - Обложка книги
            <div style="margin-top: 40px;">
        <input type="file" accept="application/pdf" name="book_pdf" value="" method='POST' required> - pdf
</div>
        </div>
    <hr>
        <div style="text-align: center; padding: 10px; font-size: 32px;"><button style="background-color: #67ACED;
                border-radius: 10px; padding: 10px;" type="submit" >Обновить книгу</button></div>
    </div>

    <div class="secondPart" style="width: 600px;">
        <div class="bookFullName" style="font-size: 32px; margin-bottom: 20px;">
<input style="font-size: 32px; border-radius: 5px;" type="text" name="name" value="{{book.name}}" method='POST' required> - Name
            <hr>
        </div>
        <div class="bookFullInfo" style=" border-radius:10px;padding: 20px; background-color: #F4F0F0; width: 100%; display: flex; justify-content: space-between;">
            <div>
            <div>

            <label><input type="text" name="book_country" value="{{book.book_country}}" method='POST' required> - book country</label>
            <p><input type="text" name="publishing_house" value="{{book.publishing_house}}" method='POST' required> - publishing house</p>
            <p><input type="text" name="author_name" value="{{book.author_name}}" method='POST' required> - Author</p>
            <p><input type="date" name="year" value="{{book.year}}" method='POST' required> - year</p>
            </div>
            </div>
        </div>

        <hr>


        <div style="font-size: 32px;" class="bookDescription">
            <hr>


            <textarea cols="200" rows="5" maxlength="1000" style="font-size: 22px; width:100%; padding: 5px; border-radius: 5px;" type="text"
                      name="book_description" value="{{book.book_description}}" method='POST' required></textarea>
        </div>

            </div>
</form>
{% endif %}
</div>

<div id="bookComments" class="tab-content">
    <div class="comment" style="width: 80%; margin: auto; background-color: #F4F0F0; height: 500px; overflow: scroll;">
    {%if user.is_authenticated %}
<form action="{%url 'add_comment' %}"  method="post">
{% csrf_token %}
        <div class="news__template">
                                <div style="display: flex;
                                        justify-content: space-between;">
                                    <div style="word-wrap: break-word;" class="news__template__message">
                                        <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                                        <textarea type="text" name="add_comment" value="" method='POST' placeholder="Comment" required
                                                  style="padding:5px; font-size:24px;" cols="80" rows="3" maxlength="200"></textarea>
                                    </div>
                                </div>
                                <div class="news__template__info">
                                    <button style="border-radius: 5px; font-size: 14px;" type="submit" >add</button>
                                </div>
            </div>
        <hr>

</form>
                                        {% endif %}
        {% for comment in comments %}
            <div class="news__template">
                                <div style="display: flex;
                                        justify-content: space-between;">
                                    <div style="word-wrap: break-word;" class="news__template__message">
                                        {{comment.text}}
                                    </div>
                                    <div>
                                        {%if user.is_staff or user.pk == comment.user_id.pk%}
                                            <form action="{%url 'delete_comment' %}"  method="post">
                                                {% csrf_token %}
                                                <input type="text" name="id" value="{{book.pk}}" method='POST' style="display: none">
                                                <input type="text" name="comment" value="{{comment.pk}}" method='POST' style="display: none">
                                                <button type="submit" style="border-radius: 5px; font-size: 12px">Удалить</button>
                                            </form>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="news__template__info">
                                    <div class="news__template__info__author">{{comment.user_id.username}}</div>
                                </div>
            </div>
        <hr>

{% endfor %}


    </div>
</div>

</div>
<footer>
    <p id="themeText">Тема
    <button id="darkTheme" disabled="disabled">T</button>
    <button id="whiteTheme" disabled="disabled">T</button>
    </p>
</footer>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script src="{% static 'js/lib.js'%}"></script>
<script>

    function openCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "flex";
    evt.currentTarget.className += " active";
}

    document.getElementById("defaultOpen").click();
</script>
</body>
</html>